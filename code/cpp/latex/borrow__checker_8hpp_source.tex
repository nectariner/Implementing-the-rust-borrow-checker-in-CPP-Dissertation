\hypertarget{borrow__checker_8hpp_source}{}\doxysection{borrow\+\_\+checker.\+hpp}
\mbox{\hyperlink{borrow__checker_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{2 \textcolor{preprocessor}{\#include <cassert>}}
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{4 }
\DoxyCodeLine{21 \textcolor{keyword}{enum class} \mbox{\hyperlink{borrow__checker_8hpp_a5d74787dedbc4e11c1ab15bf487e61f8}{State}}}
\DoxyCodeLine{22 \{}
\DoxyCodeLine{23     unset, }
\DoxyCodeLine{24     \mbox{\hyperlink{borrow__checker_8hpp_a5d74787dedbc4e11c1ab15bf487e61f8aabad918b15c9cb768e7fd0b7144c9559}{mut\_ref}},}
\DoxyCodeLine{25     const\_ref,}
\DoxyCodeLine{26     invalid,}
\DoxyCodeLine{27 \};}
\DoxyCodeLine{28 }
\DoxyCodeLine{32 \textcolor{keyword}{struct }\mbox{\hyperlink{structS}{S}}}
\DoxyCodeLine{33 \{}
\DoxyCodeLine{34 \textcolor{keyword}{private}:}
\DoxyCodeLine{35     \textcolor{keywordtype}{int} *data;}
\DoxyCodeLine{36     \textcolor{keywordtype}{int} *const\_ref\_count;}
\DoxyCodeLine{37     \textcolor{keywordtype}{int} *mut\_ref\_count;}
\DoxyCodeLine{38     \mbox{\hyperlink{borrow__checker_8hpp_a5d74787dedbc4e11c1ab15bf487e61f8}{State}} *state;}
\DoxyCodeLine{39 }
\DoxyCodeLine{40     std::size\_t increment\_mut\_ref\_count()}
\DoxyCodeLine{41     \{}
\DoxyCodeLine{42         assert(*const\_ref\_count == 0);}
\DoxyCodeLine{43         assert(*mut\_ref\_count == 0);}
\DoxyCodeLine{44         ++*mut\_ref\_count;}
\DoxyCodeLine{45         *state = \mbox{\hyperlink{borrow__checker_8hpp_a5d74787dedbc4e11c1ab15bf487e61f8aabad918b15c9cb768e7fd0b7144c9559}{State::mut\_ref}};}
\DoxyCodeLine{46         \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{47     \}}
\DoxyCodeLine{48 }
\DoxyCodeLine{49     std::size\_t increment\_const\_ref\_count()}
\DoxyCodeLine{50     \{}
\DoxyCodeLine{51         assert(*mut\_ref\_count == 0);}
\DoxyCodeLine{52         ++*const\_ref\_count;}
\DoxyCodeLine{53         *state = State::const\_ref;}
\DoxyCodeLine{54         \textcolor{keywordflow}{return} *const\_ref\_count;}
\DoxyCodeLine{55     \}}
\DoxyCodeLine{56 }
\DoxyCodeLine{57     \mbox{\hyperlink{structS}{S}}() \{\}}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 \textcolor{keyword}{public}:}
\DoxyCodeLine{60     \textcolor{comment}{// S() : data\{\}, const\_ref\_count\{new int(0)\}, mut\_ref\_count\{new int(0)\}, state\{unset\} \{\}}}
\DoxyCodeLine{63 \textcolor{comment}{}    \mbox{\hyperlink{structS_a3be0910d1646146baf572c5bf2ee88bb}{S}}(\textcolor{keywordtype}{int} \_data) : data\{\}}
\DoxyCodeLine{64     \{}
\DoxyCodeLine{65         state = \textcolor{keyword}{new} \mbox{\hyperlink{borrow__checker_8hpp_a5d74787dedbc4e11c1ab15bf487e61f8}{State}}(State::unset);}
\DoxyCodeLine{66         data = \textcolor{keyword}{new} int(\_data);}
\DoxyCodeLine{67         mut\_ref\_count = \textcolor{keyword}{new} int(0);}
\DoxyCodeLine{68         const\_ref\_count = \textcolor{keyword}{new} int(0);}
\DoxyCodeLine{69     \}}
\DoxyCodeLine{70 }
\DoxyCodeLine{71     \mbox{\hyperlink{structS}{S}} get\_mut\_ref()}
\DoxyCodeLine{72     \{}
\DoxyCodeLine{73         increment\_mut\_ref\_count();}
\DoxyCodeLine{74         \mbox{\hyperlink{structS}{S}} new\_s;}
\DoxyCodeLine{75         new\_s.data = data;}
\DoxyCodeLine{76         new\_s.const\_ref\_count = const\_ref\_count;}
\DoxyCodeLine{77         new\_s.mut\_ref\_count = mut\_ref\_count;}
\DoxyCodeLine{78         new\_s.state = state;}
\DoxyCodeLine{79 }
\DoxyCodeLine{80         \textcolor{keywordflow}{return} new\_s;}
\DoxyCodeLine{81     \}}
\DoxyCodeLine{82 }
\DoxyCodeLine{83     \mbox{\hyperlink{structS}{S}} get\_const\_ref()}
\DoxyCodeLine{84     \{}
\DoxyCodeLine{85         \mbox{\hyperlink{structS}{S}} new\_s;}
\DoxyCodeLine{86         new\_s.data = data;}
\DoxyCodeLine{87         new\_s.const\_ref\_count = const\_ref\_count;}
\DoxyCodeLine{88         new\_s.mut\_ref\_count = mut\_ref\_count;}
\DoxyCodeLine{89         new\_s.state = state;}
\DoxyCodeLine{90 }
\DoxyCodeLine{91         increment\_const\_ref\_count();}
\DoxyCodeLine{92         \textcolor{keywordflow}{return} new\_s;}
\DoxyCodeLine{93     \}}
\DoxyCodeLine{94 }
\DoxyCodeLine{95     \mbox{\hyperlink{structS}{\string~S}}()}
\DoxyCodeLine{96     \{}
\DoxyCodeLine{97         std::cout << \textcolor{stringliteral}{"{}destructor\(\backslash\)n"{}};}
\DoxyCodeLine{98         \textcolor{keywordflow}{if} (*state == State::unset)}
\DoxyCodeLine{99         \{}
\DoxyCodeLine{100             free(data);}
\DoxyCodeLine{101             free(const\_ref\_count);}
\DoxyCodeLine{102             free(mut\_ref\_count);}
\DoxyCodeLine{103             free(state);}
\DoxyCodeLine{104         \}}
\DoxyCodeLine{105         \textcolor{keywordflow}{else}}
\DoxyCodeLine{106         \{}
\DoxyCodeLine{107             \textcolor{keywordflow}{if} (*state == State::const\_ref)}
\DoxyCodeLine{108             \{}
\DoxyCodeLine{109                 -\/-\/*const\_ref\_count;}
\DoxyCodeLine{110                 \textcolor{keywordflow}{if} (*const\_ref\_count == 0)}
\DoxyCodeLine{111                     *state = State::unset;}
\DoxyCodeLine{112             \}}
\DoxyCodeLine{113             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (*state == \mbox{\hyperlink{borrow__checker_8hpp_a5d74787dedbc4e11c1ab15bf487e61f8aabad918b15c9cb768e7fd0b7144c9559}{State::mut\_ref}})}
\DoxyCodeLine{114             \{}
\DoxyCodeLine{115                 -\/-\/*mut\_ref\_count;}
\DoxyCodeLine{116                 \textcolor{keywordflow}{if} (*mut\_ref\_count == 0)}
\DoxyCodeLine{117                     *state = State::unset;}
\DoxyCodeLine{118             \}}
\DoxyCodeLine{119         \}}
\DoxyCodeLine{120     \}}
\DoxyCodeLine{121 }
\DoxyCodeLine{122     \textcolor{keywordtype}{void} set\_data(\textcolor{keywordtype}{int} new\_data)}
\DoxyCodeLine{123     \{}
\DoxyCodeLine{124         \textcolor{keywordflow}{if} (get\_state() == \mbox{\hyperlink{borrow__checker_8hpp_a5d74787dedbc4e11c1ab15bf487e61f8aabad918b15c9cb768e7fd0b7144c9559}{State::mut\_ref}})}
\DoxyCodeLine{125         \{}
\DoxyCodeLine{126             std::cout << \textcolor{stringliteral}{"{}bruh\(\backslash\)n"{}};}
\DoxyCodeLine{127             *data = new\_data;}
\DoxyCodeLine{128         \}}
\DoxyCodeLine{129         \textcolor{keywordflow}{else}}
\DoxyCodeLine{130         \{}
\DoxyCodeLine{131             std::cout << \textcolor{stringliteral}{"{}how does state !-\/ mut\_ref??\(\backslash\)n"{}};}
\DoxyCodeLine{132             \textcolor{comment}{// create a proper error class;}}
\DoxyCodeLine{133             \textcolor{keywordflow}{throw};}
\DoxyCodeLine{134         \}}
\DoxyCodeLine{135     \}}
\DoxyCodeLine{136 }
\DoxyCodeLine{137     \mbox{\hyperlink{borrow__checker_8hpp_a5d74787dedbc4e11c1ab15bf487e61f8}{State}} get\_state()}
\DoxyCodeLine{138     \{}
\DoxyCodeLine{139         \textcolor{keywordflow}{return} *state;}
\DoxyCodeLine{140     \}}
\DoxyCodeLine{141 }
\DoxyCodeLine{142     \textcolor{keywordtype}{void} print\_state()}
\DoxyCodeLine{143     \{}
\DoxyCodeLine{144         \textcolor{keywordflow}{switch} (*state)}
\DoxyCodeLine{145         \{}
\DoxyCodeLine{146         \textcolor{keywordflow}{case} State::unset:}
\DoxyCodeLine{147             std::cout << \textcolor{stringliteral}{"{}unset\(\backslash\)n"{}};}
\DoxyCodeLine{148             \textcolor{keywordflow}{break};}
\DoxyCodeLine{149         \textcolor{keywordflow}{case} State::const\_ref:}
\DoxyCodeLine{150             std::cout << \textcolor{stringliteral}{"{}const\_ref\(\backslash\)n"{}};}
\DoxyCodeLine{151             \textcolor{keywordflow}{break};}
\DoxyCodeLine{152         \textcolor{keywordflow}{case} \mbox{\hyperlink{borrow__checker_8hpp_a5d74787dedbc4e11c1ab15bf487e61f8aabad918b15c9cb768e7fd0b7144c9559}{State::mut\_ref}}:}
\DoxyCodeLine{153             std::cout << \textcolor{stringliteral}{"{}mut\_ref\(\backslash\)n"{}};}
\DoxyCodeLine{154             \textcolor{keywordflow}{break};}
\DoxyCodeLine{155 }
\DoxyCodeLine{156         \textcolor{keywordflow}{case} State::invalid:}
\DoxyCodeLine{157             std::cout << \textcolor{stringliteral}{"{}invalid state\(\backslash\)n"{}};}
\DoxyCodeLine{158             \textcolor{keywordflow}{break};}
\DoxyCodeLine{159         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{160             std::cout << \textcolor{stringliteral}{"{}invalid state\(\backslash\)n"{}};}
\DoxyCodeLine{161             \textcolor{keywordflow}{break};}
\DoxyCodeLine{162         \}}
\DoxyCodeLine{163     \}}
\DoxyCodeLine{164     std::size\_t get\_const\_ref\_count() \{ \textcolor{keywordflow}{return} *const\_ref\_count; \}}
\DoxyCodeLine{165     std::size\_t get\_mut\_ref\_count() \{ \textcolor{keywordflow}{return} *mut\_ref\_count; \}}
\DoxyCodeLine{166 \};}

\end{DoxyCode}
